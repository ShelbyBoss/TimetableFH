<Page
    x:Class="TimtableFH.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:TimtableFH"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:con="using:StdOttUwp.Converters"
    xmlns:spi="using:StdOttUwp.Converters.Specialized"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <x:Int32 x:Key="zero">0</x:Int32>
        <spi:VisibleCollapsedConverter x:Key="visNoEleCon" CompareValue="{StaticResource zero}"/>

        <!--<local:CompareType x:Key="ignore">Ignore</local:CompareType>-->
        <spi:VisibleCollapsedConverter x:Key="visIgnoreCon" CompareValue="{StaticResource ignore}"/>
        <spi:CollapsedVisibleConverter x:Key="colIgnoreCon" CompareValue="{StaticResource ignore}"/>

        <local:CompareTypeIconConverter x:Key="comIcoCon"/>
    </Page.Resources>

    <ScrollViewer>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <con:SingleInputConverter x:Name="sicNames" Input="{Binding Names}"/>
            
            <Grid Grid.Row="0" DataContext="{Binding NotAdmittedClasses}" Margin="3,3,3,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Text="Not Admitted Classes:" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="3"/>

                <ItemsControl Grid.Row="1" ItemsSource="{Binding}">
                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <local:NameCompareControl Margin="3" Value="{Binding}" Names="{Binding ElementName=sicNames,Path=Input}"/>
                                <SymbolIcon Grid.Column="4" Symbol="Remove" Margin="8,3" Tapped="SinRemoveClass_Tapped"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock Grid.Row="1" Text="No Classes" Margin="3"
                           Visibility="{Binding Count,Converter={StaticResource visNoEleCon}}"/>

                <Button Grid.Row="2" Content="Add" HorizontalAlignment="Right" Width="70" Margin="3" Tapped="BtnAddClasses_Tapped"/>
            </Grid>

            <Grid Grid.Row="1" DataContext="{Binding Groups}" Margin="3">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Text="Groups:" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="3"/>

                <ListBox Grid.Row="1" Background="Transparent" ItemsSource="{Binding Collection}"
                         SelectedIndex="{Binding CurrentGroupIndex,Mode=TwoWay}">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="{Binding Name}" Margin="3"/>
                                <SymbolIcon Grid.Column="1" Symbol="Edit" Margin="8,3" Tapped="SinEditGroup_Tapped"/>
                                <SymbolIcon Grid.Column="2" Symbol="Remove" Margin="8,3" Tapped="SinRemoveGroup_Tapped"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <TextBlock Grid.Row="1" Text="No Groups" Margin="3"
                           Visibility="{Binding Collection.Count,Converter={StaticResource visNoEleCon}}"/>

                <Button Grid.Row="2" Content="Add" HorizontalAlignment="Right" Width="70" Margin="3" Tapped="BtnAddGroup_Tapped"/>
            </Grid>

            <Grid Grid.Row="2" DataContext="{Binding EventColors}" Margin="3,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Text="Colors:" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="3"/>

                <TextBlock Grid.Row="1" Text="DefaultColor:" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="3"/>
                <Rectangle Grid.Row="1" Fill="{Binding DefaultBrush}" HorizontalAlignment="Right"
                           Width="100" Height="30" Margin="3" Tapped="BtnChangeColor_Tapped"/>

                <ItemsControl Grid.Row="2" ItemsSource="{Binding Collection}">
                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Grid Grid.Column="0" Visibility="{Binding GroupCompareType,Converter={StaticResource colIgnoreCon}}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{Binding Group}" Margin="3"/>
                                    <SymbolIcon Grid.Column="1" Symbol="{Binding GroupCompareType,Converter={StaticResource comIcoCon}}" Margin="3"/>
                                </Grid>
                                <SymbolIcon Grid.Column="0" Symbol="Remove" Margin="3" HorizontalAlignment="Center"
                                            Visibility="{Binding GroupCompareType,Converter={StaticResource visIgnoreCon}}"/>


                                <Grid Grid.Column="1" Visibility="{Binding NameCompareType,Converter={StaticResource colIgnoreCon}}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{Binding Name}" Margin="3"/>
                                    <SymbolIcon Grid.Column="1" Symbol="{Binding NameCompareType,Converter={StaticResource comIcoCon}}" Margin="3"/>
                                </Grid>
                                <SymbolIcon Grid.Column="1" Symbol="Remove" Margin="3" HorizontalAlignment="Center"
                                            Visibility="{Binding NameCompareType,Converter={StaticResource visIgnoreCon}}"/>

                                <Rectangle Grid.Column="2" Fill="{Binding Brush}" Width="50" VerticalAlignment="Stretch" Margin="3"/>
                                <SymbolIcon Grid.Column="3" Symbol="Edit" Margin="8,3" Tapped="SinEditColor_Tapped"/>
                                <SymbolIcon Grid.Column="4" Symbol="Remove" Margin="8,3" Tapped="SinRemoveColor_Tapped"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock Grid.Row="2" Text="No Colors" Margin="3"
                           Visibility="{Binding Collection.Count,Converter={StaticResource visNoEleCon}}"/>

                <Button Grid.Row="3" Content="Add" HorizontalAlignment="Right" Width="70" Margin="3" Tapped="BtnAddColor_Tapped"/>
            </Grid>

            <Grid Grid.Row="3" DataContext="{Binding EventNames}" Margin="3,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Text="Names:" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="3"/>

                <ItemsControl Grid.Row="1" ItemsSource="{Binding}">
                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="{Binding Reference}" Margin="3"/>
                                <SymbolIcon Grid.Column="1" Symbol="{Binding CompareType,Converter={StaticResource comIcoCon}}" Margin="3"/>
                                <TextBlock Grid.Column="2" Text="{Binding Short}" Margin="3"/>
                                <SymbolIcon Grid.Column="3" Symbol="Edit" Margin="8,3" Tapped="SinEditName_Tapped"/>
                                <SymbolIcon Grid.Column="4" Symbol="Remove" Margin="8,3" Tapped="SinRemoveName_Tapped"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock Grid.Row="1" Text="No Names" Margin="3"
                           Visibility="{Binding Count,Converter={StaticResource visNoEleCon}}"/>

                <Button Grid.Row="2" Content="Add" HorizontalAlignment="Right" Width="70" Margin="3" Tapped="BtnAddName_Tapped"/>
            </Grid>

            <Grid Grid.Row="4" DataContext="{Binding ReplaceValues}" Margin="3,10,3,3">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Text="Replacement:" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="3"/>

                <ItemsControl Grid.Row="1" ItemsSource="{Binding}" Margin="3">
                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="{Binding Reference}" Margin="3"/>
                                <TextBlock Grid.Column="1" Text="{Binding Replacement}" Margin="3"/>
                                <SymbolIcon Grid.Column="2" Symbol="Edit" Margin="8,3" Tapped="SinEditReplace_Tapped"/>
                                <SymbolIcon Grid.Column="3" Symbol="Remove" Margin="8,3" Tapped="SinRemoveReplace_Tapped"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock Grid.Row="1" Text="No Replacements" Margin="3"
                           Visibility="{Binding Count,Converter={StaticResource visNoEleCon}}"/>

                <Button Grid.Row="2" Content="Add" HorizontalAlignment="Right" Width="70" Tapped="BtnAddReplace_Tapped" Margin="3"/>
            </Grid>
        </Grid>
    </ScrollViewer>

    <Page.BottomAppBar>
        <CommandBar>
            <CommandBar.PrimaryCommands>
                <AppBarButton Label="Back" Icon="Back" Tapped="AbbBack_Tapped"/>
                <AppBarButton Label="Default" Icon="Add" Tapped="AbbDefault_Tapped"/>
            </CommandBar.PrimaryCommands>
        </CommandBar>
    </Page.BottomAppBar>
</Page>
